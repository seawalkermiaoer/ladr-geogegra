<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="utf-8">
    <title>Math100 — AI GeoGebra图形计算器</title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <link rel="stylesheet" href="index.css">
</head>

<body>
    <div class="top-bar">
        <div class="logo-section">
            <img src="/Users/shuyang/.gemini/antigravity/brain/d3e575ab-43f7-4d3d-8361-16da42c23f41/math100_logo_1766247156563.png"
                alt="Math100 Logo" class="logo-img">
            <h1>Math100</h1>
        </div>
        <nav class="nav-tabs" id="mode-switcher">
            <div class="nav-tab active" data-type="graphing">绘图</div>
            <div class="nav-tab" data-type="3d">3D计算器</div>
            <div class="nav-tab" data-type="geometry">几何</div>
            <div class="nav-tab" data-type="cas">CAS</div>
        </nav>
        <div class="user-actions">
            <div class="dropdown">
                <div class="dropdown-toggle">
                    <span>导出</span>
                </div>
            </div>
        </div>
    </div>

    <main class="main-content">
        <div id="ggb-container">
            <div id="ggb-element"></div>
        </div>
        <aside class="ai-sidebar">
            <div class="ai-header">
                <div class="ai-icon">Σ AI</div>
                <h2>Math100 AI</h2>
            </div>
            <div class="ai-messages">
                <div class="welcome-card">
                    <div class="canvas-container">
                        <canvas id="geometryCanvas"></canvas>
                    </div>
                    <h3>Math100 AI</h3>
                    <p>轻松完成您所需要的动态函数曲线、空间几何、CAS、概率、3D计算。</p>
                    <div class="sample-prompts">
                        <div class="prompt-item">1. 一元二次函数曲线</div>
                        <div class="prompt-item">2. 高中数学三角函数</div>
                        <div class="prompt-item">3. 构建等边三角形并计算三角形面积</div>
                    </div>
                </div>
            </div>
            <div class="ai-input-area">
                <div class="input-container">
                    <textarea placeholder="输入问题..." rows="3"></textarea>
                    <div class="input-footer">
                        <span class="brand-tag">Powered by DeepSeek</span>
                        <button class="send-btn">➤</button>
                    </div>
                </div>
            </div>
        </aside>
    </main>

    <!-- GeoGebra App Bundle -->
    <script src="https://www.geogebra.org/apps/deployggb.js"></script>
    <script>
        // --- GeoGebra Integration ---
        var ggbApp;
        var currentMode = "graphing";

        function deployApp(mode) {
            var params = {
                "appName": mode || "graphing",
                "width": 800,
                "height": 600,
                "showToolBar": false,
                "showAlgebraInput": true,
                "showMenuBar": true,
                "enableRightClick": true,
                "enableLabelDrags": true,
                "useBrowserForJS": true,
                "allowScale": true,
                "preventFocus": false,
                "appletOnLoad": function (api) {
                    api.setSize(document.getElementById('ggb-container').clientWidth, document.getElementById('ggb-container').clientHeight);
                }
            };

            ggbApp = new GGBApplet(params, true);
            ggbApp.inject('ggb-element');
        }

        window.onload = function () {
            deployApp(currentMode);
            initCanvasAnimation();
            initTabSwitcher();
        };

        function initTabSwitcher() {
            const tabs = document.querySelectorAll('.nav-tab');
            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    tabs.forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                    const mode = tab.getAttribute('data-type');
                    deployApp(mode);
                });
            });
        }

        window.onresize = function () {
            if (window.ggbApplet) {
                const container = document.getElementById('ggb-container');
                ggbApplet.setSize(container.clientWidth, container.clientHeight);
            }
        };

        // --- Canvas Animation (Refined Version) ---
        function initCanvasAnimation() {
            const canvas = document.getElementById('geometryCanvas');
            const ctx = canvas.getContext('2d');
            let width, height;

            function resize() {
                width = canvas.parentElement.clientWidth;
                height = canvas.parentElement.clientHeight;
                canvas.width = width;
                canvas.height = height;
            }
            window.addEventListener('resize', resize);
            resize();

            let points = [
                { x: 50, y: 50 }, { x: 150, y: 30 }, { x: 200, y: 100 },
                { x: 120, y: 120 }, { x: 40, y: 90 }
            ];
            let center = { x: 100, y: 70, angle: 0, rX: 40, rY: 30 };

            function draw() {
                ctx.clearRect(0, 0, width, height);
                center.angle += 0.02;
                center.x = 100 + Math.cos(center.angle) * center.rX;
                center.y = 70 + Math.sin(center.angle) * center.rY;

                ctx.strokeStyle = 'rgba(255, 255, 255, 0.2)';
                ctx.lineWidth = 1;

                // Draw spider web
                for (let i = 0; i < points.length; i++) {
                    let next = points[(i + 1) % points.length];
                    ctx.beginPath();
                    ctx.moveTo(points[i].x, points[i].y);
                    ctx.lineTo(next.x, next.y);
                    ctx.stroke();

                    ctx.beginPath();
                    ctx.moveTo(points[i].x, points[i].y);
                    ctx.lineTo(center.x, center.y);
                    ctx.stroke();
                }

                // Small dots
                ctx.fillStyle = 'rgba(255, 255, 255, 0.8)';
                points.forEach(p => {
                    ctx.beginPath();
                    ctx.arc(p.x, p.y, 3, 0, Math.PI * 2);
                    ctx.fill();
                });

                ctx.beginPath();
                ctx.arc(center.x, center.y, 4, 0, Math.PI * 2);
                ctx.fill();

                requestAnimationFrame(draw);
            }
            draw();
        }
    </script>
</body>

</html>